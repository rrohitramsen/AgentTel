spring:
  application:
    name: payment-service

# OTel configuration — use logging exporter by default for the demo.
# Switch to otlp when running with the OTel Collector (see docker/ directory).
otel:
  traces:
    exporter: logging
  metrics:
    exporter: logging
  logs:
    exporter: none
  resource:
    attributes:
      service.name: payment-service

# AgentTel configuration
agenttel:
  enabled: true
  topology:
    team: payments-platform
    tier: critical
    domain: commerce
    on-call-channel: "#payments-oncall"
  dependencies:
    - name: payment-gateway
      type: external_api
      criticality: required
      timeout-ms: 5000
      circuit-breaker: true
      fallback: "Return cached pricing from last successful gateway call"
    - name: postgres-orders
      type: database
      criticality: required
      timeout-ms: 3000
  consumers:
    - name: notification-service
      pattern: async
  # Reusable operational profiles — reduce repetition across operations.
  profiles:
    critical-write:
      retryable: false
      idempotent: false
      escalation-level: page_oncall
      safe-to-restart: false
    read-only:
      retryable: true
      idempotent: true
      escalation-level: notify_team
      safe-to-restart: true
  # Per-operation metadata: baselines and decision context.
  # This replaces or supplements @AgentOperation annotations.
  # Operations can reference a profile for defaults, then override specific fields.
  # NOTE: Use bracket notation [key] for operation names with special characters
  # (spaces, slashes) so Spring Boot preserves the exact key.
  operations:
    "[POST /api/payments]":
      profile: critical-write
      expected-latency-p50: "45ms"
      expected-latency-p99: "200ms"
      expected-error-rate: 0.001
      retryable: true
      idempotent: true
      runbook-url: "https://wiki/runbooks/process-payment"
      fallback-description: "Returns cached pricing from last successful gateway call"
    "[GET /api/payments/{id}]":
      profile: read-only
      expected-latency-p50: "15ms"
      expected-latency-p99: "80ms"
  baselines:
    rolling-window-size: 1000
    rolling-min-samples: 10
  anomaly-detection:
    enabled: true
    z-score-threshold: 3.0
  deployment:
    emit-on-startup: true

springdoc:
  swagger-ui:
    path: /swagger-ui.html
  api-docs:
    path: /v3/api-docs

server:
  port: 8080

management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
